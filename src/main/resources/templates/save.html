<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>회원 가입</title>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // 이메일로 인증 코드 요청
            document.getElementById('emailForm').addEventListener('submit', function(event) {
                event.preventDefault(); // 폼의 기본 제출 동작 방지
                const email = document.getElementById('email').value;

                fetch('/member/send-email', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'
                    },
                    body: new URLSearchParams({ email: email })
                })
                    .then(response => {
                        if (response.ok) {
                            console.log('Email sent successfully');
                            document.getElementById('message').innerText = '인증 코드가 이메일로 전송되었습니다.';
                        } else {
                            console.log('Failed to send email');
                            document.getElementById('message').innerText = '이메일 전송에 실패했습니다.';
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        document.getElementById('message').innerText = '이메일 전송 중 오류가 발생했습니다.';
                    });
            });

            // 인증 코드 확인
            document.getElementById('authCodeForm').addEventListener('submit', function(event) {
                event.preventDefault(); // 폼의 기본 제출 동작 방지
                const authCode = document.getElementById('authCode').value;

                fetch('/member/verify-email', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'
                    },
                    body: new URLSearchParams({ code: authCode })
                })
                    .then(response => response.json())
                    .then(data => {
                        if (data) {
                            console.log('Code verified successfully');
                            document.getElementById('message').innerText = '인증 코드가 확인되었습니다.';
                        } else {
                            console.log('Invalid code');
                            document.getElementById('message').innerText = '잘못된 인증 코드입니다.';
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        document.getElementById('message').innerText = '인증 코드 확인 중 오류가 발생했습니다.';
                    });
            });

            // 아이디 중복 확인
            document.getElementById('idCheckButton').addEventListener('click', function(event) {
                event.preventDefault(); // 버튼의 기본 제출 동작 방지
                const memberId = document.getElementById('memberId').value;

                fetch('/member/id-check', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'
                    },
                    body: new URLSearchParams({ memberId: memberId })
                })
                    .then(response => response.json())
                    .then(data => {
                        if (data) {
                            document.getElementById('idCheckMessage').innerText = '이미 사용 중인 아이디입니다.';
                        } else {
                            document.getElementById('idCheckMessage').innerText = '사용 가능한 아이디입니다.';
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        document.getElementById('idCheckMessage').innerText = '아이디 중복 확인 중 오류가 발생했습니다.';
                    });
            });
        });
    </script>
</head>
<body>
<h1>회원 가입</h1>

<!-- 이메일로 인증 코드 요청 폼 -->
<form id="emailForm">
    <label for="email">이메일:</label>
    <input type="email" id="email" name="email" required />
    <button type="submit">인증 코드 요청</button>
</form>

<!-- 인증 코드 입력 폼 -->
<form id="authCodeForm">
    <label for="authCode">인증 코드:</label>
    <input type="text" id="authCode" name="authCode" required />
    <button type="submit">인증 코드 확인</button>
</form>

<!-- 아이디 중복 확인 -->
<form id="idCheckForm">
    <label for="memberId">아이디:</label>
    <input type="text" id="memberId" name="memberId" required />
    <button id="idCheckButton">아이디 중복 확인</button>
    <div id="idCheckMessage"></div>
</form>

<!-- 회원가입 폼 -->
<form method="post" action="/member/save">
    <label for="name">이름:</label>
    <input type="text" id="name" name="name" required /><br><br>

    <label for="password">비밀번호:</label>
    <input type="password" id="password" name="password" required /><br><br>

    <button type="submit">회원가입</button>
</form>

<!-- 인증 코드 발송 및 확인 알림 -->
<div id="message"></div>
</body>
</html>
